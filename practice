
``` r
# Make this randomness consistent
set.seed(1357)

# Simulate 2000 cases as described above 
n_student <- 3000

story_data <- tibble(
  # Make an ID column
  id = 1:n_student,
  # Generate term variable: uniform, between 1 and 6. Round so it's whole.
  term = round(runif(n_student, min = 1, max = 6), 0),
  # Generate school variable: binomial, 50% chance of being in a city. We'll use 
  # sample() instead of rbinom()
  school = sample(c("School A", "School B"), n_student, replace = TRUE)) %>% 
  # Generate net variable. We're assuming perfect compliance, so this will only
  # be TRUE for School B after term 3
  mutate(story = ifelse(school == "School B" & term > 3, TRUE, FALSE)) %>% 
  # Generate the score variable based on term, school, story, and random noise
  mutate(score_base = rtruncnorm(3000, mean = 65, sd = 10, a = 40, b = 100),
         # school_effect = -2, School B - School A, and noises 
         # treatment_effect = +5 and noises
         school_effect = ifelse(school == "School B", rnorm(n_student, mean = - 1.85, sd = 1), 0),
         # score goes up by 1 point on average every term
         term_effect = rnorm(n_student, mean = 2.5, sd = 0.5) * term,
         # treatment effect = +5
         story_effect = ifelse(school == "School B" & term > 3, 
                             rnorm(n_student, mean = 5.6, sd = 1), 0),
         # Finally combine all these effects to create the malaria risk variable
         score = score_base + school_effect + term_effect + story_effect,
         # Rescale so it doesn't go below 0 or above 100
         score = round(rescale(score, to = c(50, 100)))) %>% 
  # Make an indicator variable showing if the row is after 2017
  mutate(after = term > 3)
#> Error in tibble(id = 1:n_student, term = round(runif(n_student, min = 1, : could not find function "%>%"
```

<sup>Created on 2021-09-12 by the [reprex package](https://reprex.tidyverse.org) (v2.0.0)</sup>
